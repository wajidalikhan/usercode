#!/usr/bin/perl -w 

use strict;

my %efffactors;
my %long = ("e" => "Electron41", "mu" => "Muon33");

$efffactors{"e"} = {
    "120_020_0.429" => [4.1612e-06, 2.15012172157764e-06],
    "120_020_0.65" => [2.08862e-05, 5.75681630917645e-06],
    "120_020_1.3" => [7.95712e-05, 1.87426634920867e-05],
    "120_020_4.329" => [7.78744e-05, 1.84551696555301e-05],
    "120_020_6.5" => [5.99138e-05, 1.43638204255553e-05],
    "120_020_13" => [3.48326e-05, 9.15530452308387e-06],
    "120_020_130" => [1.299e-06, 1.99707186650856e-06],
    "120_020_26" => [1.6568e-05, 5.16363679590267e-06],
    "120_020_260" => [3.596e-07, 7.192e-08],
    "120_020_39" => [9.5728e-06, 4.39872026771424e-06],
    "120_020_390" => [1.6e-07, 3.2e-08],
    "120_050_1.65" => [1.83414e-05, 5.39795129270356e-06],
    "120_050_2.5" => [2.6335e-05, 6.5896349671283e-06],
    "120_050_5" => [2.24808e-05, 5.99154860996721e-06],
    "120_050_16.65" => [1.08436e-05, 2.93668970754487e-06],
    "120_050_25" => [8.7938e-06, 2.6484026766336e-06],
    "120_050_50" => [5.585e-06, 2.27343110737933e-06],
    "120_050_500" => [1.808e-07, 3.616e-08],
    "120_050_100" => [2.6194e-06, 2.04823100611235e-06],
    "120_050_1000" => [6.02e-08, 1.204e-08],
    "120_050_150" => [1.4618e-06, 2.00156797776143e-06],
    "120_050_1500" => [2.02e-08, 4.04e-09],
};
$efffactors{"mu"} = {
    "120_020_0.429" => [0.0004160026, 8.60041890158288e-05],
    "120_020_0.65" => [0.0004757926, 9.76193522237799e-05],
    "120_020_1.3" => [0.0004622788, 9.49866746295374e-05],
    "120_020_4.329" => [0.0002991212, 6.24221474444576e-05],
    "120_020_6.5" => [0.0002404406, 5.06300156540999e-05],
    "120_020_13" => [0.000151102, 3.24719352081147e-05],
    "120_020_130" => [1.92126e-05, 5.51798513502891e-06],
    "120_020_26" => [9.5868e-05, 2.15788539306424e-05],
    "120_020_260" => [6.3404e-06, 2.35134576070811e-06],
    "120_020_39" => [7.31024e-05, 1.66280256022896e-05],
    "120_020_390" => [3.1096e-06, 2.07547211168929e-06],
    "120_050_1.65" => [0.0003388638, 6.88064052106895e-05],
    "120_050_2.5" => [0.000267135, 5.47321763590669e-05],
    "120_050_5" => [0.0001861334, 3.90765876686079e-05],
    "120_050_16.65" => [0.0001284984, 2.83129361264847e-05],
    "120_050_25" => [0.0001041124, 2.30563586316313e-05],
    "120_050_50" => [6.27652e-05, 1.48428977373557e-05],
    "120_050_500" => [3.1068e-06, 2.07530437517006e-06],
    "120_050_100" => [3.23134e-05, 8.77800847472819e-06],
    "120_050_1000" => [8.894e-07, 1.7900082234448e-07],
    "120_050_150" => [1.99092e-05, 5.61589260809001e-06],
    "120_050_1500" => [4.048e-07, 8.096e-08],
};

foreach my $x (keys %efffactors) {
    my $leptype = $long{$x};
    my %effs = % {$efffactors{$x}};
    foreach my $tag (keys %effs) {
	$tag =~ /_(\d+)_/;
	my $m = $1;
	$m =~ s/^0//;
	my @eff = @ {$effs{$tag}};

	my $jobFileName = "job$x$tag";
	open JOBFILE, ">$jobFileName" or die "Couldn't open $jobFileName for writing: $!\n";
	print JOBFILE "source /afs/cern.ch/user/p/plujan/public/displacedfermions/trunk/LimitsRooStats/setup.sh\n";
	print JOBFILE "python mainSigmaBayesian.py $m $leptype $eff[0] $eff[1] $tag\n";
	close JOBFILE;
	chmod 0755, $jobFileName;

	system("bsub -q cmscaf1nh $jobFileName");
    }
}

