#!/usr/bin/perl -w 

use strict;

my %efffactors;
my %long = ("e" => "Electron41", "mu" => "Muon33");

$efffactors{"e"} = {
    "125_020_0.429" => [4.81204e-05, 1.37006791745839e-05],
    "125_020_0.65" => [4.82762e-05, 1.22185151012558e-05],
    "125_020_1.3" => [4.84512e-05, 1.14086686842247e-05],
    "125_020_4.329" => [2.76658e-05, 8.71520619934254e-06],
    "125_020_6.5" => [2.4599e-05, 7.03968474237755e-06],
    "125_020_13" => [1.80116e-05, 4.75486911973326e-06],
    "125_020_26" => [1.09384e-05, 3.14199009491514e-06],
    "125_020_39" => [7.253e-06, 2.3445301732897e-06],
    "125_020_130" => [1.6112e-06, 1.25152074902617e-06],
    "125_020_260" => [5.172e-07, 4.09750699863533e-07],
    "125_020_390" => [2.388e-07, 2.0387789706952e-07],
    "125_050_1.65" => [2.46928e-05, 7.60374682593519e-06],
    "125_050_2.5" => [3.01656e-05, 8.42808556703603e-06],
    "125_050_5" => [3.0428e-05, 8.12353558199601e-06],
    "125_050_16.65" => [6.5848e-06, 4.89813762900694e-06],
    "125_050_25" => [5.3896e-06, 3.66499662116062e-06],
    "125_050_50" => [2.6454e-06, 1.68007414904513e-06],
    "125_050_100" => [9.478e-07, 5.96327059318179e-07],
    "125_050_150" => [4.838e-07, 2.99016545561966e-07],
    "125_050_500" => [2.6338e-06, 1.66052866289888e-06],
    "125_050_1000" => [1.208e-06, 8.58669210144126e-07],
    "125_050_1500" => [6.732e-07, 5.00130356702413e-07],
};
$efffactors{"mu"} = {
    "125_020_0.429" => [0.0003438418, 7.52085385575105e-05],
    "125_020_0.65" => [0.0003491326, 7.40781000245646e-05],
    "125_020_1.3" => [0.0003389202, 7.07150325418013e-05],
    "125_020_4.329" => [0.0002823718, 6.26205633889655e-05],
    "125_020_6.5" => [0.0002331458, 5.0314715409135e-05],
    "125_020_13" => [0.0001517996, 3.22236260194527e-05],
    "125_020_26" => [0.0001033004, 2.75941813784751e-05],
    "125_020_39" => [9.79758e-05, 4.49369325624836e-05],
    "125_020_130" => [2.67182e-05, 7.58321216375572e-06],
    "125_020_260" => [1.00106e-05, 2.8684409244564e-06],
    "125_020_390" => [5.165e-06, 1.48518728228557e-06],
    "125_050_1.65" => [0.0002532704, 6.24278731753844e-05],
    "125_050_2.5" => [0.0002411108, 5.8024803858022e-05],
    "125_050_5" => [0.0002145006, 5.08772325552104e-05],
    "125_050_16.65" => [0.0001467424, 4.19076633549088e-05],
    "125_050_25" => [0.0001117028, 3.04521797790949e-05],
    "125_050_50" => [6.1764e-05, 1.62954127202136e-05],
    "125_050_100" => [2.872e-05, 7.78294710155315e-06],
    "125_050_150" => [1.65916e-05, 4.63683555939014e-06],
    "125_050_500" => [8.1536e-06, 3.24076884290926e-06],
    "125_050_1000" => [3.6554e-06, 1.59053524688264e-06],
    "125_050_1500" => [2.0356e-06, 9.21743025808984e-07],
};

foreach my $x (keys %efffactors) {
    my $leptype = $long{$x};
    my %effs = % {$efffactors{$x}};
    foreach my $tag (keys %effs) {
	$tag =~ /_(\d+)_/;
	my $m = $1;
	$m =~ s/^0//;
	my @eff = @ {$effs{$tag}};

	my $jobFileName = "job$x$tag";
	open JOBFILE, ">$jobFileName" or die "Couldn't open $jobFileName for writing: $!\n";
	print JOBFILE "source /afs/cern.ch/user/p/plujan/public/displacedfermions/trunk/LimitsRooStats/setup.sh\n";
	print JOBFILE "python mainSigmaBayesian.py $m $leptype $eff[0] $eff[1] $tag\n";
	close JOBFILE;
	chmod 0755, $jobFileName;

	system("bsub -q cmscaf1nh $jobFileName");
    }
}

